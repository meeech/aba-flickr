<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
        <title></title>
<script src="http://yui.yahooapis.com/3.0.0/build/yui/yui-min.js"></script>
<style type="text/css" media="screen">
div#shell {
    border: 1px solid red;
    height: 100%;
    width: 100%;
    position:relative;
}

/*image item*/
div#shell div>div {
    border: 1px solid grey;
    display: inline-block;
    vertical-align: top;
}

/*gallery title*/
div#shell div h2{
    background-color: white;
    border: 1px solid yellow;
    position: absolute;
    z-index: 1;
}

/*Picture Title*/
div#shell div span {
    border: 1px solid blue;
    display: block;
    text-align: center;
}

div#shell div.index span, /*We want to hide the picture title when its the gallery thumb*/
.hide {
    visibility: hidden !important;
    display: none !important;
}
</style>
    <link rel="stylesheet" type="text/css" href="http://localhost/shadowbox-3.0.2/shadowbox.css">
    <script type="text/javascript" src="http://localhost/shadowbox-3.0.2/shadowbox.js"></script>
    </head>
<body>
    <div id="shell">
    </div>

<script type="text/javascript" charset="utf-8">
// Init so it has global scope - keeps things simpler.
var jsonFlickrFeed;
// domready wrapped in use
YUI().use('node', 'substitute', 'dump', 'event-delegate', function(Y) { Y.on("domready", function() {
// BEGIN Y closure
// Used for filtering to get the tag name
var flickrUserName = 'amisoll'; 
// Used for fetching the feed
var flickrUserId = '35130544@N02'; 

Shadowbox.init({
    skipSetup: true
});
// 
// Shadowbox.open({
//        content:    '<div id="welcome-msg">Welcome to my website!</div>',
//        player:     "html",
//        title:      "Welcome",
//        height:     350,
//        width:      350
//    });
//Our data dump. 
var bb = Y.namespace(flickrUserName.concat('.data'));

jsonFlickrFeed = function (data) {
    if( Y.Lang.isUndefined(data.items)) { return false; }  
    Y.one('#shell').append(initgallery(data));
    return true;
};

/** 
 * This builds initial gallery - the index basically
 * also caches returned data into the bb.tagName
 *
 * @param data full returned data from flickr
 * @return Node (the container div)
 */
var initgallery = function(data) {
    var randomIndex = Math.floor(Math.random()*data.items.length); //Can this be a bug? ever be == length?    
    
    //We can filter based on usename plain english...
    var tagName = data.title.replace('Uploads from ' + flickrUserName + ', tagged ', '');
    bb[tagName] = {};
    
    var container = Y.Node.create('<div id="' + tagName + '"></div>');
    container.append(Y.Node.create('<h2>' + tagName + '</h2>'));
    //Store data under tag name Make index image
    bb[tagName]['indexImage'] = data.items.slice(randomIndex,randomIndex+1)[0];
    bb[tagName]['images'] = data.items;
    bb[tagName]['container'] = container;
    container.append(buildGalleryNode(bb[tagName]['indexImage']).addClass('index'));
    return container;
};

//Build all the gallery images. 
var buildGallery = function(items,container) {
    // Y.each(data.items, function(item, index) {
    //      var nodehtml = buildGalleryItem(item);
    //      container.append(Y.Node.create(nodehtml));
    // });
};

/**
 * 
 * @param item obj image data
 * @options usual - class, id, whatnot. will add as necessary
 * @return Node
 */

var buildGalleryNode = function(item, options) {
    var htmlT = "<div class='{class}'><a href='{image_src}'><img src='{thumb_src}'></a><br><span>{title}</span></div>";
    item['thumb_src'] = item.media.m; //fix the src
    item['image_src'] = item.media.m.replace('_m.jpg', '.jpg'); //fix the src
    item['class'] = '';
    return Y.Node.create(Y.substitute(htmlT , item));
};

//Show hide the gallery thumbs...
Y.delegate('click', function(e) {
    var imagesNodes = this.ancestor().all('div');
    imagesNodes.addClass('hide');
    imagesNodes.item(0).replaceClass('hide','index');
}, 'div#shell',  'h2');

//show the stack when cover image is clicked. 
//remove hide class from the stack,
//Remove index class from picture
Y.delegate('click', function(e) {
    e.halt();
    this.ancestor().removeClass('index');
    this.ancestor().ancestor().get('children').removeClass('hide');
}, 'div#shell', 'div.index a');

var defaultArgs = ['id='+flickrUserId,'lang=en-us','format=json'];
var baseFlickrUrl = 'http://api.flickr.com/services/feeds/photos_public.gne?' + defaultArgs.join('&');

var objTransaction = Y.Get.script([
    // 'http://localhost/shadowbox-build-3.0rc1/shadowbox.js',
    baseFlickrUrl + "&tags=montreal"
    // baseFlickrUrl + "&tags=fireworks"
],  {
    onEnd: function() {
        console.log('ended');        
    }
});

//end closure
});});
</script>

</body>
</html>
